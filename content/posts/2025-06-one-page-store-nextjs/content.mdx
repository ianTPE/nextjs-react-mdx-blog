## 前言

在 2025 年的網頁開發領域中，打造一個高效能、美觀且功能完整的電商網站已經變得比以往更加重要。隨著技術的快速發展，開發者現在擁有了更強大的工具和框架來建立出色的線上商店。本文將深入探討如何使用 Next.js 14/15、React 19、MDX、Tailwind CSS、Shadcn/UI 和 TypeScript 這套現代化技術堆棧，從零開始打造一個功能完整的一頁式電商網站。

### 為什麼選擇一頁式商店？

一頁式商店（One-Page Store）是一種將所有主要功能集中在單一頁面的電商設計模式。這種設計方式能夠提供流暢的使用者體驗，減少頁面載入時間，並提高轉換率。對於產品數量相對較少的品牌或想要快速測試市場反應的新創公司來說，一頁式商店是一個理想的選擇。

## 技術堆棧深度解析

### 1. Next.js 15 - 強大的 React 框架

Next.js 是由 Vercel 開發的全端 React 框架，提供了檔案式路由、動態路由和條件渲染等核心功能。最新版本的 Next.js 15 帶來了許多重要的改進：

- **App Router**：提供更靈活的路由系統和佈局管理
- **Server Components**：預設使用伺服器元件，提升效能和 SEO
- **Turbopack**：更快的開發環境建置速度
- **內建圖片優化**：自動優化圖片載入和顯示

### 2. React 19 - 現代化的 UI 函式庫

React 19 作為最新版本，帶來了許多效能優化和開發體驗的改進：

- **並行渲染**：提升大型應用的渲染效能
- **自動批次更新**：減少不必要的重新渲染
- **改進的錯誤邊界**：更好的錯誤處理機制

### 3. MDX - 強大的內容管理解決方案

MDX 是 Markdown 的擴展，允許你在 Markdown 檔案中直接撰寫 JSX。這對於電商網站來說特別有用，因為：

- **豐富的產品描述**：可以在產品描述中嵌入互動式元件
- **動態內容**：輕鬆整合圖表、動畫和其他 React 元件
- **易於維護**：內容與程式碼分離，便於非技術人員編輯

### 4. Tailwind CSS - 實用優先的 CSS 框架

Tailwind CSS 提供了一套完整的實用類別系統，讓你能夠快速建立美觀的介面：

- **快速開發**：直接在 HTML 中使用預定義的類別
- **一致性設計**：確保整個網站的視覺一致性
- **高度可自訂**：可以根據品牌需求調整設計系統

### 5. Shadcn/UI - 現代化的元件庫

Shadcn/UI 不是傳統的元件庫，而是一個可以直接複製到專案中的元件集合。它的特點包括：

- **完全可自訂**：每個元件的原始碼都在你的專案中
- **無障礙設計**：所有元件都遵循 WCAG 標準
- **與 Tailwind 完美整合**：使用 Tailwind CSS 進行樣式設計

### 6. TypeScript - 類型安全的 JavaScript

TypeScript 為 JavaScript 添加了靜態類型檢查，提供：

- **更少的執行時錯誤**：在編譯時期就能發現大部分錯誤
- **更好的開發體驗**：智慧型程式碼提示和自動完成
- **更容易重構**：類型系統讓大規模重構變得更安全

## 詳細實作步驟

### 步驟 1：專案初始化與環境設置

首先，我們需要建立一個新的 Next.js 專案並設置所有必要的依賴項：

```bash
# 使用最新版本的 create-next-app 建立專案
npx create-next-app@latest my-store --typescript --tailwind --eslint --app --src-dir

# 進入專案目錄
cd my-store

# 安裝額外的依賴項
npm install @next/mdx @mdx-js/loader @mdx-js/react gray-matter reading-time
npm install zustand @tanstack/react-query
npm install framer-motion lucide-react
npm install @radix-ui/react-slot class-variance-authority clsx tailwind-merge
```

### 步驟 2：設置 Shadcn/UI

Shadcn/UI 的設置需要特別注意，因為它會直接影響整個專案的元件結構：

```bash
# 初始化 Shadcn/UI
npx shadcn-ui@latest init
```

在初始化過程中，選擇以下選項：
- TypeScript：Yes
- 樣式：Default
- 基礎顏色：Slate（或根據品牌選擇）
- CSS 變數：Yes

接著安裝我們需要的元件：

```bash
# 安裝電商網站常用的元件
npx shadcn-ui@latest add button card dialog sheet badge
npx shadcn-ui@latest add input label textarea select
npx shadcn-ui@latest add separator skeleton toast
npx shadcn-ui@latest add dropdown-menu navigation-menu
```

### 步驟 3：配置 MDX 支援

MDX 的配置對於管理產品內容至關重要。建立 `next.config.mjs`：

```javascript
import createMDX from '@next/mdx'
import remarkGfm from 'remark-gfm'
import rehypePrism from 'rehype-prism-plus'

const withMDX = createMDX({
  options: {
    remarkPlugins: [remarkGfm],
    rehypePlugins: [rehypePrism],
  },
})

/** @type {import('next').NextConfig} */
const nextConfig = {
  pageExtensions: ['ts', 'tsx', 'mdx'],
  images: {
    domains: ['images.unsplash.com', 'cdn.shopify.com'],
  },
  experimental: {
    mdxRs: true,
  },
}

export default withMDX(nextConfig)
```

建立 `mdx-components.tsx` 來定義全域 MDX 元件：

```typescript
import type { MDXComponents } from 'mdx/types'
import Image from 'next/image'
import { Button } from '@/components/ui/button'
import { Card } from '@/components/ui/card'

export function useMDXComponents(components: MDXComponents): MDXComponents {
  return {
    ...components,
    h1: ({ children }) => (
      <h1 className="text-4xl font-bold tracking-tight mb-4">{children}</h1>
    ),
    h2: ({ children }) => (
      <h2 className="text-3xl font-semibold mb-3">{children}</h2>
    ),
    p: ({ children }) => (
      <p className="text-muted-foreground leading-7 mb-4">{children}</p>
    ),
    Image,
    Button,
    Card,
  }
}
```

### 步驟 4：建立專案結構

一個組織良好的專案結構對於維護和擴展至關重要：

```
src/
├── app/
│   ├── layout.tsx
│   ├── page.tsx
│   └── globals.css
├── components/
│   ├── ui/           # Shadcn/UI 元件
│   ├── store/        # 商店特定元件
│   │   ├── ProductCard.tsx
│   │   ├── ProductGrid.tsx
│   │   ├── CartSheet.tsx
│   │   ├── CheckoutDialog.tsx
│   │   └── SearchBar.tsx
│   └── layout/       # 佈局元件
│       ├── Header.tsx
│       ├── Footer.tsx
│       └── Hero.tsx
├── content/
│   └── products/     # MDX 產品檔案
│       ├── product-1.mdx
│       ├── product-2.mdx
│       └── product-3.mdx
├── lib/
│   ├── store.ts      # Zustand 狀態管理
│   ├── api.ts        # API 函數
│   └── utils.ts      # 工具函數
├── types/
│   └── index.ts      # TypeScript 類型定義
└── hooks/            # 自訂 Hooks
    ├── useCart.ts
    └── useProducts.ts
```

### 步驟 5：定義資料類型

建立 `src/types/index.ts` 來定義專案中使用的所有類型：

```typescript
export interface Product {
  id: string
  name: string
  slug: string
  price: number
  salePrice?: number
  description: string
  shortDescription: string
  images: string[]
  category: string
  tags: string[]
  inStock: boolean
  quantity: number
  variants?: ProductVariant[]
  features: string[]
  specifications: Record<string, string>
  reviews: Review[]
  rating: number
  createdAt: Date
  updatedAt: Date
}

export interface ProductVariant {
  id: string
  name: string
  price: number
  image?: string
  inStock: boolean
  attributes: Record<string, string>
}

export interface Review {
  id: string
  userId: string
  userName: string
  rating: number
  comment: string
  createdAt: Date
  helpful: number
}

export interface CartItem {
  productId: string
  variantId?: string
  quantity: number
  product: Product
  variant?: ProductVariant
}

export interface ShippingInfo {
  fullName: string
  email: string
  phone: string
  address: string
  city: string
  state: string
  zipCode: string
  country: string
}

export interface Order {
  id: string
  items: CartItem[]
  shipping: ShippingInfo
  subtotal: number
  tax: number
  shipping: number
  total: number
  status: 'pending' | 'processing' | 'shipped' | 'delivered' | 'cancelled'
  createdAt: Date
}
```

### 步驟 6：實作狀態管理

使用 Zustand 建立全域狀態管理，建立 `src/lib/store.ts`：

```typescript
import { create } from 'zustand'
import { persist, createJSONStorage } from 'zustand/middleware'
import { CartItem, Product, ProductVariant } from '@/types'

interface CartStore {
  items: CartItem[]
  isOpen: boolean
  
  // 購物車操作
  addItem: (product: Product, variant?: ProductVariant, quantity?: number) => void
  removeItem: (productId: string, variantId?: string) => void
  updateQuantity: (productId: string, quantity: number, variantId?: string) => void
  clearCart: () => void
  
  // UI 操作
  openCart: () => void
  closeCart: () => void
  
  // 計算屬性
  getTotalItems: () => number
  getSubtotal: () => number
  getTax: (rate?: number) => number
  getTotal: (taxRate?: number) => number
}

export const useCart = create<CartStore>()(
  persist(
    (set, get) => ({
      items: [],
      isOpen: false,
      
      addItem: (product, variant, quantity = 1) => {
        set((state) => {
          const existingItem = state.items.find(
            item => item.productId === product.id && 
                   item.variantId === variant?.id
          )
          
          if (existingItem) {
            return {
              items: state.items.map(item =>
                item.productId === product.id && item.variantId === variant?.id
                  ? { ...item, quantity: item.quantity + quantity }
                  : item
              )
            }
          }
          
          return {
            items: [...state.items, {
              productId: product.id,
              variantId: variant?.id,
              quantity,
              product,
              variant
            }]
          }
        })
      },
      
      removeItem: (productId, variantId) => {
        set((state) => ({
          items: state.items.filter(
            item => !(item.productId === productId && item.variantId === variantId)
          )
        }))
      },
      
      updateQuantity: (productId, quantity, variantId) => {
        if (quantity <= 0) {
          get().removeItem(productId, variantId)
          return
        }
        
        set((state) => ({
          items: state.items.map(item =>
            item.productId === productId && item.variantId === variantId
              ? { ...item, quantity }
              : item
          )
        }))
      },
      
      clearCart: () => set({ items: [] }),
      openCart: () => set({ isOpen: true }),
      closeCart: () => set({ isOpen: false }),
      
      getTotalItems: () => {
        return get().items.reduce((total, item) => total + item.quantity, 0)
      },
      
      getSubtotal: () => {
        return get().items.reduce((total, item) => {
          const price = item.variant?.price ?? item.product.salePrice ?? item.product.price
          return total + (price * item.quantity)
        }, 0)
      },
      
      getTax: (rate = 0.08) => {
        return get().getSubtotal() * rate
      },
      
      getTotal: (taxRate = 0.08) => {
        const subtotal = get().getSubtotal()
        return subtotal + get().getTax(taxRate)
      }
    }),
    {
      name: 'shopping-cart',
      storage: createJSONStorage(() => localStorage),
    }
  )
)
```

### 步驟 7：建立核心元件

#### 產品卡片元件

建立 `src/components/store/ProductCard.tsx`：

```typescript
'use client'

import Image from 'next/image'
import { useState } from 'react'
import { motion } from 'framer-motion'
import { ShoppingCart, Heart, Eye } from 'lucide-react'
import { Card, CardContent, CardFooter } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { useCart } from '@/lib/store'
import { Product } from '@/types'
import { cn } from '@/lib/utils'

interface ProductCardProps {
  product: Product
  onQuickView?: (product: Product) => void
}

export function ProductCard({ product, onQuickView }: ProductCardProps) {
  const [isHovered, setIsHovered] = useState(false)
  const [isFavorite, setIsFavorite] = useState(false)
  const { addItem, openCart } = useCart()
  
  const discount = product.salePrice 
    ? Math.round(((product.price - product.salePrice) / product.price) * 100)
    : 0
  
  const handleAddToCart = () => {
    addItem(product)
    openCart()
  }
  
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4 }}
      whileHover={{ y: -5 }}
    >
      <Card 
        className="relative overflow-hidden group cursor-pointer"
        onMouseEnter={() => setIsHovered(true)}
        onMouseLeave={() => setIsHovered(false)}
      >
        {/* 折扣標籤 */}
        {discount > 0 && (
          <Badge className="absolute top-2 left-2 z-10" variant="destructive">
            -{discount}%
          </Badge>
        )}
        
        {/* 收藏按鈕 */}
        <Button
          size="icon"
          variant="ghost"
          className="absolute top-2 right-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity"
          onClick={() => setIsFavorite(!isFavorite)}
        >
          <Heart className={cn("h-4 w-4", isFavorite && "fill-current text-red-500")} />
        </Button>
        
        {/* 產品圖片 */}
        <div className="relative aspect-square overflow-hidden bg-gray-100">
          <Image
            src={product.images[0]}
            alt={product.name}
            fill
            className="object-cover transition-transform duration-300 group-hover:scale-110"
            sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
          />
          
          {/* 快速預覽按鈕 */}
          {isHovered && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              className="absolute inset-0 bg-black/40 flex items-center justify-center"
            >
              <Button
                variant="secondary"
                onClick={() => onQuickView?.(product)}
                className="gap-2"
              >
                <Eye className="h-4 w-4" />
                快速預覽
              </Button>
            </motion.div>
          )}
        </div>
        
        <CardContent className="p-4">
          <h3 className="font-medium text-lg mb-1 line-clamp-1">{product.name}</h3>
          <p className="text-sm text-muted-foreground mb-2 line-clamp-2">
            {product.shortDescription}
          </p>
          
          <div className="flex items-center gap-2 mb-2">
            {product.salePrice ? (
              <>
                <span className="font-bold text-lg">${product.salePrice}</span>
                <span className="text-sm text-muted-foreground line-through">
                  ${product.price}
                </span>
              </>
            ) : (
              <span className="font-bold text-lg">${product.price}</span>
            )}
          </div>
          
          {/* 評分 */}
          <div className="flex items-center gap-1">
            {[...Array(5)].map((_, i) => (
              <svg
                key={i}
                className={cn(
                  "h-4 w-4",
                  i < Math.floor(product.rating) 
                    ? "text-yellow-400 fill-current" 
                    : "text-gray-300"
                )}
                viewBox="0 0 20 20"
              >
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            ))}
            <span className="text-sm text-muted-foreground ml-1">
              ({product.reviews.length})
            </span>
          </div>
        </CardContent>
        
        <CardFooter className="p-4 pt-0">
          <Button 
            className="w-full" 
            onClick={handleAddToCart}
            disabled={!product.inStock}
          >
            <ShoppingCart className="mr-2 h-4 w-4" />
            {product.inStock ? '加入購物車' : '缺貨中'}
          </Button>
        </CardFooter>
      </Card>
    </motion.div>
  )
}
```

#### 購物車側邊欄元件

建立 `src/components/store/CartSheet.tsx`：

```typescript
'use client'

import Image from 'next/image'
import { Sheet, SheetContent, SheetHeader, SheetTitle } from '@/components/ui/sheet'
import { Button } from '@/components/ui/button'
import { Separator } from '@/components/ui/separator'
import { Badge } from '@/components/ui/badge'
import { ScrollArea } from '@/components/ui/scroll-area'
import { Minus, Plus, Trash2, ShoppingBag } from 'lucide-react'
import { useCart } from '@/lib/store'
import { motion, AnimatePresence } from 'framer-motion'

export function CartSheet() {
  const { 
    items, 
    isOpen, 
    closeCart, 
    updateQuantity, 
    removeItem,
    getTotalItems,
    getSubtotal,
    getTax,
    getTotal 
  } = useCart()
  
  const subtotal = getSubtotal()
  const tax = getTax()
  const total = getTotal()
  
  return (
    <Sheet open={isOpen} onOpenChange={closeCart}>
      <SheetContent className="w-full sm:max-w-md">
        <SheetHeader>
          <SheetTitle className="flex items-center gap-2">
            <ShoppingBag className="h-5 w-5" />
            購物車 ({getTotalItems()})
          </SheetTitle>
        </SheetHeader>
        
        {items.length === 0 ? (
          <div className="flex flex-col items-center justify-center h-[50vh] space-y-4">
            <ShoppingBag className="h-16 w-16 text-muted-foreground" />
            <p className="text-lg text-muted-foreground">您的購物車是空的</p>
            <Button onClick={closeCart}>繼續購物</Button>
          </div>
        ) : (
          <>
            <ScrollArea className="flex-1 mt-4 pr-4" style={{ height: 'calc(100vh - 280px)' }}>
              <AnimatePresence mode="popLayout">
                {items.map((item) => {
                  const price = item.variant?.price ?? item.product.salePrice ?? item.product.price
                  
                  return (
                    <motion.div
                      key={\`\${item.productId}-\${item.variantId}\`}
                      layout
                      initial={{ opacity: 0, x: -20 }}
                      animate={{ opacity: 1, x: 0 }}
                      exit={{ opacity: 0, x: 20 }}
                      className="flex gap-4 py-4 border-b"
                    >
                      <div className="relative h-24 w-24 rounded-md overflow-hidden bg-gray-100">
                        <Image
                          src={item.product.images[0]}
                          alt={item.product.name}
                          fill
                          className="object-cover"
                        />
                      </div>
                      
                      <div className="flex-1 space-y-2">
                        <h4 className="font-medium line-clamp-1">{item.product.name}</h4>
                        {item.variant && (
                          <p className="text-sm text-muted-foreground">
                            {item.variant.name}
                          </p>
                        )}
                        <div className="flex items-center justify-between">
                          <span className="font-medium">${price}</span>
                          
                          <div className="flex items-center gap-2">
                            <Button
                              size="icon"
                              variant="outline"
                              className="h-8 w-8"
                              onClick={() => updateQuantity(
                                item.productId, 
                                item.quantity - 1, 
                                item.variantId
                              )}
                            >
                              <Minus className="h-3 w-3" />
                            </Button>
                            
                            <span className="w-8 text-center">{item.quantity}</span>
                            
                            <Button
                              size="icon"
                              variant="outline"
                              className="h-8 w-8"
                              onClick={() => updateQuantity(
                                item.productId, 
                                item.quantity + 1, 
                                item.variantId
                              )}
                            >
                              <Plus className="h-3 w-3" />
                            </Button>
                            
                            <Button
                              size="icon"
                              variant="ghost"
                              className="h-8 w-8 text-destructive"
                              onClick={() => removeItem(item.productId, item.variantId)}
                            >
                              <Trash2 className="h-4 w-4" />
                            </Button>
                          </div>
                        </div>
                      </div>
                    </motion.div>
                  )
                })}
              </AnimatePresence>
            </ScrollArea>
            
            <div className="space-y-4 mt-6">
              <Separator />
              
              <div className="space-y-2">
                <div className="flex justify-between text-sm">
                  <span>小計</span>
                  <span>${subtotal.toFixed(2)}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span>稅金</span>
                  <span>${tax.toFixed(2)}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span>運費</span>
                  <Badge variant="secondary">免運費</Badge>
                </div>
                <Separator />
                <div className="flex justify-between font-semibold text-lg">
                  <span>總計</span>
                  <span>${total.toFixed(2)}</span>
                </div>
              </div>
              
              <Button className="w-full" size="lg">
                前往結帳
              </Button>
              
              <Button variant="outline" className="w-full" onClick={closeCart}>
                繼續購物
              </Button>
            </div>
          </>
        )}
      </SheetContent>
    </Sheet>
  )
}
```

### 步驟 8：建立 MDX 產品內容

MDX 允許我們在 Markdown 中嵌入 JSX，這對於創建豐富的產品描述特別有用。建立產品 MDX 檔案 `src/content/products/wireless-headphones.mdx`：

```mdx
---
id: "prod_001"
name: "WaveSound Pro 無線降噪耳機"
slug: "wavesound-pro-headphones"
price: 299.99
salePrice: 249.99
category: "音響設備"
tags: ["無線", "降噪", "高音質"]
inStock: true
quantity: 50
images:
  - "/images/headphones-1.jpg"
  - "/images/headphones-2.jpg"
  - "/images/headphones-3.jpg"
shortDescription: "體驗前所未有的音質，搭載主動降噪技術的頂級無線耳機"
features:
  - "40mm 動態驅動單元"
  - "主動降噪技術 (ANC)"
  - "30 小時電池續航"
  - "快速充電功能"
  - "藍牙 5.0 連接"
specifications:
  驅動單元: "40mm 動態驅動"
  頻率響應: "20Hz - 20kHz"
  阻抗: "32Ω"
  靈敏度: "105dB"
  電池容量: "750mAh"
  充電時間: "2小時"
  重量: "250g"
---

import { ProductFeatures } from '@/components/store/ProductFeatures'
import { TechSpecs } from '@/components/store/TechSpecs'

## 沉浸式音質體驗

WaveSound Pro 無線降噪耳機採用先進的 **40mm 動態驅動單元**，提供深沉的低音、清晰的中音和明亮的高音。無論是聆聽音樂、觀看電影還是進行視訊會議，都能享受到錄音室級別的音質。

### 主動降噪技術

搭載最新的 ANC 主動降噪技術，能夠有效消除高達 **95% 的環境噪音**。無論您身處繁忙的街道、吵雜的咖啡廳還是飛機上，都能享受屬於自己的寧靜空間。

<ProductFeatures features={[
  {
    icon: "🎵",
    title: "Hi-Res 高解析音質",
    description: "支援 LDAC 編碼，提供接近無損的音質體驗"
  },
  {
    icon: "🔋",
    title: "超長續航",
    description: "單次充電可連續使用 30 小時，快充 15 分鐘即可使用 5 小時"
  },
  {
    icon: "🎤",
    title: "清晰通話",
    description: "6 個麥克風陣列搭配 AI 降噪算法，確保通話清晰"
  },
  {
    icon: "📱",
    title: "多設備連接",
    description: "可同時連接兩個藍牙設備，輕鬆切換"
  }
]} />

### 舒適佩戴設計

採用記憶海綿耳墊和可調節頭帶設計，即使長時間佩戴也不會感到不適。可折疊設計方便攜帶，附贈的硬殼收納盒能夠完美保護您的耳機。

### 智慧功能

- **自適應降噪**：根據環境噪音自動調整降噪強度
- **環境音模式**：無需摘下耳機即可聽到周圍聲音
- **觸控操作**：輕觸耳罩即可控制音樂播放和接聽電話
- **語音助手**：支援 Siri、Google Assistant 和 Alexa

<TechSpecs specs={{
  "驅動單元": "40mm 動態驅動",
  "頻率響應": "20Hz - 20kHz",
  "阻抗": "32Ω",
  "靈敏度": "105dB",
  "電池容量": "750mAh",
  "充電時間": "2小時",
  "重量": "250g",
  "藍牙版本": "5.0",
  "支援編碼": "SBC, AAC, LDAC",
  "降噪深度": "-35dB"
}} />

### 包裝內容

- WaveSound Pro 無線耳機 × 1
- USB-C 充電線 × 1
- 3.5mm 音源線 × 1
- 飛機轉接頭 × 1
- 硬殼收納盒 × 1
- 使用說明書 × 1
```

### 步驟 9：實作產品載入系統

建立 `src/lib/products.ts` 來處理 MDX 產品檔案的載入：

```typescript
import fs from 'fs'
import path from 'path'
import matter from 'gray-matter'
import { Product } from '@/types'

const productsDirectory = path.join(process.cwd(), 'src/content/products')

export async function getProductSlugs() {
  const files = fs.readdirSync(productsDirectory)
  return files.map(file => file.replace(/\.mdx$/, ''))
}

export async function getProductBySlug(slug: string): Promise<Product> {
  const fullPath = path.join(productsDirectory, \`\${slug}.mdx\`)
  const fileContents = fs.readFileSync(fullPath, 'utf8')
  const { data, content } = matter(fileContents)
  
  // 計算評分（示例：隨機生成或從評論計算）
  const rating = data.reviews 
    ? data.reviews.reduce((acc: number, review: any) => acc + review.rating, 0) / data.reviews.length
    : 4.5
  
  return {
    ...data,
    content,
    rating,
    reviews: data.reviews || [],
    createdAt: new Date(data.createdAt || Date.now()),
    updatedAt: new Date(data.updatedAt || Date.now()),
  } as Product
}

export async function getAllProducts(): Promise<Product[]> {
  const slugs = await getProductSlugs()
  const products = await Promise.all(
    slugs.map(slug => getProductBySlug(slug))
  )
  
  return products.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())
}

export async function getProductsByCategory(category: string): Promise<Product[]> {
  const products = await getAllProducts()
  return products.filter(product => product.category === category)
}

export async function getFeaturedProducts(): Promise<Product[]> {
  const products = await getAllProducts()
  // 選擇有折扣或評分高的產品作為精選
  return products
    .filter(product => product.salePrice || product.rating >= 4.5)
    .slice(0, 6)
}

export async function searchProducts(query: string): Promise<Product[]> {
  const products = await getAllProducts()
  const lowercaseQuery = query.toLowerCase()
  
  return products.filter(product => 
    product.name.toLowerCase().includes(lowercaseQuery) ||
    product.description.toLowerCase().includes(lowercaseQuery) ||
    product.tags.some(tag => tag.toLowerCase().includes(lowercaseQuery))
  )
}
```

### 步驟 10：建立主頁面

整合所有元件，建立 `src/app/page.tsx`：

```typescript
import { Suspense } from 'react'
import { getAllProducts, getFeaturedProducts } from '@/lib/products'
import { Header } from '@/components/layout/Header'
import { Hero } from '@/components/layout/Hero'
import { ProductGrid } from '@/components/store/ProductGrid'
import { FeaturedProducts } from '@/components/store/FeaturedProducts'
import { Newsletter } from '@/components/layout/Newsletter'
import { Footer } from '@/components/layout/Footer'
import { CartSheet } from '@/components/store/CartSheet'
import { SearchCommand } from '@/components/store/SearchCommand'
import { ProductGridSkeleton } from '@/components/skeletons/ProductGridSkeleton'

export default async function HomePage() {
  const [products, featuredProducts] = await Promise.all([
    getAllProducts(),
    getFeaturedProducts()
  ])
  
  return (
    <>
      <Header />
      <main className="min-h-screen">
        {/* 主橫幅區域 */}
        <Hero />
        
        {/* 精選產品 */}
        <section className="container mx-auto px-4 py-12">
          <div className="text-center mb-8">
            <h2 className="text-3xl font-bold mb-2">精選商品</h2>
            <p className="text-muted-foreground">探索我們最受歡迎的產品</p>
          </div>
          <FeaturedProducts products={featuredProducts} />
        </section>
        
        {/* 所有產品 */}
        <section className="container mx-auto px-4 py-12" id="products">
          <div className="text-center mb-8">
            <h2 className="text-3xl font-bold mb-2">所有商品</h2>
            <p className="text-muted-foreground">瀏覽我們的完整產品系列</p>
          </div>
          
          <Suspense fallback={<ProductGridSkeleton />}>
            <ProductGrid products={products} />
          </Suspense>
        </section>
        
        {/* 電子報訂閱 */}
        <Newsletter />
      </main>
      
      <Footer />
      
      {/* 全域元件 */}
      <CartSheet />
      <SearchCommand products={products} />
    </>
  )
}
```

### 步驟 11：效能優化

#### 1. 圖片優化

使用 Next.js 的 Image 元件和適當的載入策略：

```typescript
// 建立圖片載入元件
import Image from 'next/image'
import { useState } from 'react'
import { cn } from '@/lib/utils'

interface OptimizedImageProps {
  src: string
  alt: string
  className?: string
  priority?: boolean
}

export function OptimizedImage({ src, alt, className, priority }: OptimizedImageProps) {
  const [isLoading, setIsLoading] = useState(true)
  
  return (
    <div className={cn("relative overflow-hidden bg-gray-100", className)}>
      <Image
        src={src}
        alt={alt}
        fill
        priority={priority}
        className={cn(
          "object-cover duration-700 ease-in-out",
          isLoading ? "scale-110 blur-2xl grayscale" : "scale-100 blur-0 grayscale-0"
        )}
        onLoadingComplete={() => setIsLoading(false)}
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
      />
    </div>
  )
}
```

#### 2. 程式碼分割和延遲載入

```typescript
// 使用動態導入進行程式碼分割
import dynamic from 'next/dynamic'

// 延遲載入大型元件
const ProductQuickView = dynamic(
  () => import('@/components/store/ProductQuickView'),
  { 
    loading: () => <ProductQuickViewSkeleton />,
    ssr: false 
  }
)

const ReviewSection = dynamic(
  () => import('@/components/store/ReviewSection'),
  { loading: () => <ReviewSectionSkeleton /> }
)
```

#### 3. 資料預取和快取

使用 React Query 進行資料管理：

```typescript
// src/hooks/useProducts.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { getAllProducts, searchProducts } from '@/lib/products'

export function useProducts() {
  return useQuery({
    queryKey: ['products'],
    queryFn: getAllProducts,
    staleTime: 5 * 60 * 1000, // 5 分鐘
    cacheTime: 10 * 60 * 1000, // 10 分鐘
  })
}

export function useProductSearch(query: string) {
  return useQuery({
    queryKey: ['products', 'search', query],
    queryFn: () => searchProducts(query),
    enabled: query.length > 2,
    staleTime: 2 * 60 * 1000,
  })
}

// 預取產品資料
export function usePrefetchProducts() {
  const queryClient = useQueryClient()
  
  return () => {
    queryClient.prefetchQuery({
      queryKey: ['products'],
      queryFn: getAllProducts,
    })
  }
}
```

### 步驟 12：SEO 優化

建立 SEO 元件和結構化資料：

```typescript
// src/components/seo/ProductJsonLd.tsx
export function ProductJsonLd({ product }: { product: Product }) {
  const jsonLd = {
    '@context': 'https://schema.org',
    '@type': 'Product',
    name: product.name,
    description: product.description,
    image: product.images,
    offers: {
      '@type': 'Offer',
      price: product.salePrice || product.price,
      priceCurrency: 'TWD',
      availability: product.inStock 
        ? 'https://schema.org/InStock' 
        : 'https://schema.org/OutOfStock',
    },
    aggregateRating: {
      '@type': 'AggregateRating',
      ratingValue: product.rating,
      reviewCount: product.reviews.length,
    },
  }
  
  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
    />
  )
}
```

### 步驟 13：部署準備

#### 環境變數設置

建立 `.env.local`：

```env
# API 端點
NEXT_PUBLIC_API_URL=https://api.yourstore.com

# 第三方服務
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_xxx
STRIPE_SECRET_KEY=sk_test_xxx

# 分析工具
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
NEXT_PUBLIC_FACEBOOK_PIXEL_ID=xxxxxxxxxxxxx

# 圖片 CDN
NEXT_PUBLIC_IMAGE_CDN=https://cdn.yourstore.com
```

#### 建置優化配置

更新 `next.config.mjs`：

```javascript
const nextConfig = {
  // ... 其他配置
  
  // 生產環境優化
  swcMinify: true,
  compress: true,
  
  // 圖片優化
  images: {
    formats: ['image/avif', 'image/webp'],
    minimumCacheTTL: 60,
  },
  
  // 實驗性功能
  experimental: {
    optimizeCss: true,
    optimizePackageImports: ['lucide-react', 'framer-motion'],
  },
  
  // HTTP 標頭
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'X-DNS-Prefetch-Control',
            value: 'on'
          },
          {
            key: 'X-Frame-Options',
            value: 'SAMEORIGIN'
          },
        ],
      },
    ]
  },
}
```

## 進階功能實作

### 1. 即時搜尋功能

實作一個快速、響應式的搜尋功能對於提升使用者體驗至關重要：

```typescript
// src/components/store/SearchCommand.tsx
'use client'

import { useEffect, useState } from 'react'
import { Command, CommandDialog, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from '@/components/ui/command'
import { useDebounce } from '@/hooks/useDebounce'
import { Product } from '@/types'
import { Search } from 'lucide-react'

export function SearchCommand({ products }: { products: Product[] }) {
  const [open, setOpen] = useState(false)
  const [search, setSearch] = useState('')
  const debouncedSearch = useDebounce(search, 300)
  
  const filteredProducts = products.filter(product =>
    product.name.toLowerCase().includes(debouncedSearch.toLowerCase()) ||
    product.description.toLowerCase().includes(debouncedSearch.toLowerCase())
  )
  
  useEffect(() => {
    const down = (e: KeyboardEvent) => {
      if (e.key === 'k' && (e.metaKey || e.ctrlKey)) {
        e.preventDefault()
        setOpen((open) => !open)
      }
    }
    
    document.addEventListener('keydown', down)
    return () => document.removeEventListener('keydown', down)
  }, [])
  
  return (
    <CommandDialog open={open} onOpenChange={setOpen}>
      <CommandInput 
        placeholder="搜尋產品..." 
        value={search}
        onValueChange={setSearch}
      />
      <CommandList>
        <CommandEmpty>找不到相關產品</CommandEmpty>
        <CommandGroup heading="產品">
          {filteredProducts.slice(0, 5).map((product) => (
            <CommandItem
              key={product.id}
              onSelect={() => {
                // 導航到產品頁面
                window.location.href = \`/products/\${product.slug}\`
                setOpen(false)
              }}
            >
              <Search className="mr-2 h-4 w-4" />
              <span>{product.name}</span>
            </CommandItem>
          ))}
        </CommandGroup>
      </CommandList>
    </CommandDialog>
  )
}
```

### 2. 進階篩選系統

建立多維度的產品篩選功能：

```typescript
// src/components/store/ProductFilters.tsx
export function ProductFilters({ 
  categories, 
  priceRange, 
  onFilterChange 
}: ProductFiltersProps) {
  const [filters, setFilters] = useState({
    category: 'all',
    minPrice: 0,
    maxPrice: 9999,
    inStock: false,
    sortBy: 'featured'
  })
  
  return (
    <aside className="w-64 space-y-6">
      {/* 分類篩選 */}
      <div>
        <h3 className="font-semibold mb-3">商品分類</h3>
        <RadioGroup
          value={filters.category}
          onValueChange={(value) => {
            setFilters({ ...filters, category: value })
            onFilterChange({ ...filters, category: value })
          }}
        >
          <div className="space-y-2">
            <Label className="flex items-center gap-2">
              <RadioGroupItem value="all" />
              所有商品
            </Label>
            {categories.map((category) => (
              <Label key={category} className="flex items-center gap-2">
                <RadioGroupItem value={category} />
                {category}
              </Label>
            ))}
          </div>
        </RadioGroup>
      </div>
      
      {/* 價格範圍 */}
      <div>
        <h3 className="font-semibold mb-3">價格範圍</h3>
        <div className="space-y-4">
          <Slider
            min={0}
            max={1000}
            step={10}
            value={[filters.minPrice, filters.maxPrice]}
            onValueChange={([min, max]) => {
              setFilters({ ...filters, minPrice: min, maxPrice: max })
              onFilterChange({ ...filters, minPrice: min, maxPrice: max })
            }}
          />
          <div className="flex justify-between text-sm">
            <span>${filters.minPrice}</span>
            <span>${filters.maxPrice}</span>
          </div>
        </div>
      </div>
      
      {/* 其他篩選選項 */}
      <div>
        <Label className="flex items-center gap-2">
          <Checkbox
            checked={filters.inStock}
            onCheckedChange={(checked) => {
              setFilters({ ...filters, inStock: checked as boolean })
              onFilterChange({ ...filters, inStock: checked as boolean })
            }}
          />
          僅顯示有庫存商品
        </Label>
      </div>
    </aside>
  )
}
```

## 最佳實踐與技巧

### 1. 程式碼組織

保持程式碼的模組化和可維護性：

- **元件分離**：將大型元件拆分成更小的、可重用的部分
- **自訂 Hooks**：抽取共用邏輯到自訂 Hooks 中
- **類型安全**：充分利用 TypeScript 的類型系統
- **命名規範**：使用一致的命名規範（如 PascalCase 用於元件，camelCase 用於函數）

### 2. 效能監控

使用 Next.js 內建的效能分析工具：

```typescript
// 在 next.config.mjs 中啟用分析
const nextConfig = {
  // ... 其他配置
  
  // 啟用效能分析
  analytics: {
    enabled: true,
  },
  
  // Web Vitals 報告
  experimental: {
    webVitalsAttribution: ['CLS', 'LCP', 'FCP', 'FID', 'TTFB'],
  },
}
```

### 3. 無障礙設計

確保網站對所有使用者都是可訪問的：

```typescript
// 使用語意化 HTML 和 ARIA 屬性
<nav role="navigation" aria-label="主導航">
  <ul>
    {navItems.map((item) => (
      <li key={item.id}>
        <Link 
          href={item.href}
          aria-current={pathname === item.href ? 'page' : undefined}
        >
          {item.label}
        </Link>
      </li>
    ))}
  </ul>
</nav>

// 確保互動元素有適當的焦點樣式
<Button 
  className="focus:ring-2 focus:ring-primary focus:ring-offset-2"
  aria-label="加入購物車"
>
  <ShoppingCart className="h-4 w-4" aria-hidden="true" />
  加入購物車
</Button>
```

## 部署與上線

### Vercel 部署

Vercel 是部署 Next.js 應用程式的最佳選擇，提供自動化部署和優化：

1. 將程式碼推送到 GitHub
2. 在 Vercel 上匯入專案
3. 設置環境變數
4. 自動部署完成

### 效能監控和分析

部署後，使用以下工具監控網站效能：

- **Vercel Analytics**：內建的效能分析
- **Google Analytics 4**：使用者行為分析
- **Sentry**：錯誤追蹤和效能監控

## 結論

使用 Next.js、React、MDX、Tailwind CSS、Shadcn/UI 和 TypeScript 建立一頁式電商網站，不僅能夠提供優秀的使用者體驗，還能確保開發效率和程式碼品質。透過本文詳細的步驟指南和最佳實踐，你現在擁有了建立現代化電商網站所需的所有知識和工具。

這套技術堆棧的優勢在於：

1. **開發效率**：完善的開發工具和元件庫大幅提升開發速度
2. **效能優異**：Next.js 的優化功能確保網站載入快速
3. **SEO 友好**：伺服器端渲染和結構化資料提升搜尋引擎排名
4. **易於維護**：TypeScript 和模組化設計讓程式碼更容易維護
5. **擴展性強**：可以輕鬆添加新功能和整合第三方服務

隨著電商市場的持續成長，掌握這些現代化的開發技術將讓你在競爭中保持領先。無論是建立新的電商品牌，還是為現有業務開發線上銷售管道，這套技術堆棧都能滿足你的需求。

記住，成功的電商網站不僅需要優秀的技術實作，還需要持續的優化和改進。定期收集使用者回饋，分析網站數據，並根據市場變化調整策略，才能確保你的一頁式商店在激烈的市場競爭中脫穎而出。
